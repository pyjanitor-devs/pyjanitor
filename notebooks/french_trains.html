
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Processing French train data &#8212; pyjanitor  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "document", "processHtmlClass": "math|output_area"}}</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Groupby_agg : Shortcut for assigning a groupby-transform to a new column." href="groupby_agg.html" />
    <link rel="prev" title="Expand_grid : Create a dataframe from all combinations of inputs." href="expand_grid.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Processing-French-train-data">
<h1>Processing French train data<a class="headerlink" href="#Processing-French-train-data" title="Permalink to this headline">¶</a></h1>
<section id="Background">
<h2>Background<a class="headerlink" href="#Background" title="Permalink to this headline">¶</a></h2>
<p>The SNCF (National Society of French Railways) is France’s national state-owned railway company. Founded in 1938, it operates the country’s national rail traffic along with Monaco, including the TGV, France’s high-speed rail network. This dataset covers 2015-2018 with many different train stations. The dataset primarily covers aggregate trip times, delay times, cause for delay, etc., for each station there are 27 columns in total. A TGV route map can be seen
<a class="reference external" href="https://en.wikipedia.org/wiki/TGV#/media/File:France_TGV.png">here</a>.</p>
</section>
<section id="The-data">
<h2>The data<a class="headerlink" href="#The-data" title="Permalink to this headline">¶</a></h2>
<p>The source data set is available from the <a class="reference external" href="https://ressources.data.sncf.com/explore/dataset/regularite-mensuelle-tgv-aqst/information/">SNCF</a>. Check out this <a class="reference external" href="https://twitter.com/noccaea/status/1095735292206739456">visualization</a> of it. This has been used in a <a class="reference external" href="https://github.com/rfordatascience/tidytuesday/tree/master/data/2019/2019-02-26">tidy tuesday</a> previously. The <a class="reference external" href="https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-02-26/full_trains.csv">full data
set</a> is available but we will work with a <a class="reference external" href="https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-02-26/small_trains.csv">subset</a>.</p>
</section>
<section id="Preliminaries">
<h2>Preliminaries<a class="headerlink" href="#Preliminaries" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>
<span class="kn">import</span> <span class="nn">janitor</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># allow plots to appear directly in the notebook</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</section>
<section id="Call-chaining-example">
<h2>Call chaining example<a class="headerlink" href="#Call-chaining-example" title="Permalink to this headline">¶</a></h2>
<p>First, we run all the methods using pyjanitor’s preferred call chaining approach. This code updates the column names, removes any empty rows/columns, and drops some unneeded columns in a very readable manner.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">chained_df</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
        <span class="s2">&quot;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-02-26/small_trains.csv&quot;</span>
    <span class="p">)</span>  <span class="c1"># ingest raw data</span>
    <span class="o">.</span><span class="n">clean_names</span><span class="p">()</span>  <span class="c1"># removes whitespace, punctuation/symbols, capitalization</span>
    <span class="o">.</span><span class="n">remove_empty</span><span class="p">()</span>  <span class="c1"># removes entirely empty rows / columns</span>
    <span class="o">.</span><span class="n">rename_column</span><span class="p">(</span><span class="s2">&quot;num_late_at_departure&quot;</span><span class="p">,</span> <span class="s2">&quot;num_departing_late&quot;</span><span class="p">)</span>  <span class="c1"># renames 1 column</span>
    <span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;service&quot;</span><span class="p">,</span> <span class="s2">&quot;delay_cause&quot;</span><span class="p">,</span> <span class="s2">&quot;delayed_number&quot;</span><span class="p">])</span>  <span class="c1"># drops 3 unnecessary columns</span>
    <span class="c1"># add 2 new columns with a calculation</span>
    <span class="o">.</span><span class="n">join_apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">num_departing_late</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">total_num_trips</span><span class="p">,</span>
        <span class="s1">&#39;prop_late_departures&#39;</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">join_apply</span><span class="p">(</span>
        <span class="k">lambda</span> <span class="n">df</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">num_arriving_late</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">total_num_trips</span><span class="p">,</span>
        <span class="s1">&#39;prop_late_arrivals&#39;</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">chained_df</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>month</th>
      <th>departure_station</th>
      <th>arrival_station</th>
      <th>journey_time_avg</th>
      <th>total_num_trips</th>
      <th>avg_delay_all_departing</th>
      <th>avg_delay_all_arriving</th>
      <th>num_departing_late</th>
      <th>num_arriving_late</th>
      <th>prop_late_departures</th>
      <th>prop_late_arrivals</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2017</td>
      <td>9</td>
      <td>PARIS EST</td>
      <td>METZ</td>
      <td>85.133779</td>
      <td>299</td>
      <td>0.752007</td>
      <td>0.419844</td>
      <td>15</td>
      <td>17.0</td>
      <td>0.050167</td>
      <td>0.056856</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2017</td>
      <td>9</td>
      <td>REIMS</td>
      <td>PARIS EST</td>
      <td>47.064516</td>
      <td>218</td>
      <td>1.263518</td>
      <td>1.137558</td>
      <td>10</td>
      <td>23.0</td>
      <td>0.045872</td>
      <td>0.105505</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017</td>
      <td>9</td>
      <td>PARIS EST</td>
      <td>STRASBOURG</td>
      <td>116.234940</td>
      <td>333</td>
      <td>1.139257</td>
      <td>1.586396</td>
      <td>20</td>
      <td>19.0</td>
      <td>0.060060</td>
      <td>0.057057</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
<section id="Step-by-step-through-the-methods">
<h2>Step by step through the methods<a class="headerlink" href="#Step-by-step-through-the-methods" title="Permalink to this headline">¶</a></h2>
<p>Now, we will import the French data again and then use the methods from the call chain one at a time. Our subset of the train data has over 32000 rows and 13 columns.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s2">&quot;https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-02-26/small_trains.csv&quot;</span>
<span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(32772, 13)
</pre></div></div>
</div>
<section id="Cleaning-column-names">
<h3>Cleaning column names<a class="headerlink" href="#Cleaning-column-names" title="Permalink to this headline">¶</a></h3>
<p>The clean_names method converts the column names to lowercase and replaces all spaces with underscores. For this data set, it actually does not modify any of the names.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">original_columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">clean_names</span><span class="p">()</span>
<span class="n">new_columns</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
<span class="n">original_columns</span> <span class="o">==</span> <span class="n">new_columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ True,  True,  True,  True,  True,  True,  True,  True,  True,
        True,  True,  True,  True])
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">new_columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Index([&#39;year&#39;, &#39;month&#39;, &#39;service&#39;, &#39;departure_station&#39;, &#39;arrival_station&#39;,
       &#39;journey_time_avg&#39;, &#39;total_num_trips&#39;, &#39;avg_delay_all_departing&#39;,
       &#39;avg_delay_all_arriving&#39;, &#39;num_late_at_departure&#39;, &#39;num_arriving_late&#39;,
       &#39;delay_cause&#39;, &#39;delayed_number&#39;],
      dtype=&#39;object&#39;)
</pre></div></div>
</div>
</section>
<section id="Renaming-columns">
<h3>Renaming columns<a class="headerlink" href="#Renaming-columns" title="Permalink to this headline">¶</a></h3>
<p>We rename the “num_late_at_departure” column for consistency purposes with the rename_column method.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">rename_column</span><span class="p">(</span><span class="s2">&quot;num_late_at_departure&quot;</span><span class="p">,</span> <span class="s2">&quot;num_departing_late&quot;</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Index([&#39;year&#39;, &#39;month&#39;, &#39;service&#39;, &#39;departure_station&#39;, &#39;arrival_station&#39;,
       &#39;journey_time_avg&#39;, &#39;total_num_trips&#39;, &#39;avg_delay_all_departing&#39;,
       &#39;avg_delay_all_arriving&#39;, &#39;num_departing_late&#39;, &#39;num_arriving_late&#39;,
       &#39;delay_cause&#39;, &#39;delayed_number&#39;],
      dtype=&#39;object&#39;)
</pre></div></div>
</div>
</section>
<section id="Dropping-empty-columns-and-rows">
<h3>Dropping empty columns and rows<a class="headerlink" href="#Dropping-empty-columns-and-rows" title="Permalink to this headline">¶</a></h3>
<p>The remove_empty method looks for empty columns and rows and drops them if found.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(32772, 13)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">remove_empty</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(32772, 13)
</pre></div></div>
</div>
</section>
<section id="Drop-unneeded-columns">
<h3>Drop unneeded columns<a class="headerlink" href="#Drop-unneeded-columns" title="Permalink to this headline">¶</a></h3>
<p>We identify 3 columns that we decided are unnecessary for the analysis and can quickly drop them with the aptly named drop_columns method.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;service&quot;</span><span class="p">,</span> <span class="s2">&quot;delay_cause&quot;</span><span class="p">,</span> <span class="s2">&quot;delayed_number&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Index([&#39;year&#39;, &#39;month&#39;, &#39;departure_station&#39;, &#39;arrival_station&#39;,
       &#39;journey_time_avg&#39;, &#39;total_num_trips&#39;, &#39;avg_delay_all_departing&#39;,
       &#39;avg_delay_all_arriving&#39;, &#39;num_departing_late&#39;, &#39;num_arriving_late&#39;],
      dtype=&#39;object&#39;)
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># gives us the top ten departure stations from that column</span>
<span class="n">Counter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;departure_station&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[(&#39;PARIS LYON&#39;, 6834),
 (&#39;PARIS MONTPARNASSE&#39;, 4512),
 (&#39;PARIS EST&#39;, 1692),
 (&#39;LYON PART DIEU&#39;, 1476),
 (&#39;PARIS NORD&#39;, 1128),
 (&#39;MARSEILLE ST CHARLES&#39;, 1044),
 (&#39;LILLE&#39;, 846),
 (&#39;RENNES&#39;, 630),
 (&#39;NANTES&#39;, 630),
 (&#39;MONTPELLIER&#39;, 564)]
</pre></div></div>
</div>
<p>We use seaborn to quickly visualize how quickly departure and arrivals times were late versus the total number of trips for each of the over 30000 routes in the database.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span>
    <span class="n">df</span><span class="p">,</span>
    <span class="n">x_vars</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;num_departing_late&#39;</span><span class="p">,</span> <span class="s1">&#39;num_arriving_late&#39;</span><span class="p">],</span>
    <span class="n">y_vars</span><span class="o">=</span><span class="s1">&#39;total_num_trips&#39;</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">aspect</span><span class="o">=</span><span class="mf">0.7</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;seaborn.axisgrid.PairGrid at 0x7f3733c9bad0&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/notebooks_french_trains_20_1.png" src="../_images/notebooks_french_trains_20_1.png" />
</div>
</div>
</section>
<section id="Add-additional-statistics-as-new-columns">
<h3>Add additional statistics as new columns<a class="headerlink" href="#Add-additional-statistics-as-new-columns" title="Permalink to this headline">¶</a></h3>
<p>We can add columns containing additional statistics concerning the proportion of time each route is late either departing or arriving by using the add_columns method for each route.</p>
<p>Note the difference between how we added the two columns below and the same code in the chained_df file creation at the top of the notebook. In order to operate on the df that was in the process of being created in the call chain, we had to use join_apply with a lambda function instead of the add_columns method. Alternatively, we could have split the chain into two separate chains with the df being created in the first chain and the add_columns method being used in the second chain.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">df_prop</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">df</span><span class="o">.</span><span class="n">add_columns</span><span class="p">(</span>
        <span class="n">prop_late_departures</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">num_departing_late</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">total_num_trips</span><span class="p">,</span>
        <span class="n">prop_late_arrivals</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">num_arriving_late</span> <span class="o">/</span> <span class="n">df</span><span class="o">.</span><span class="n">total_num_trips</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">df_prop</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>month</th>
      <th>departure_station</th>
      <th>arrival_station</th>
      <th>journey_time_avg</th>
      <th>total_num_trips</th>
      <th>avg_delay_all_departing</th>
      <th>avg_delay_all_arriving</th>
      <th>num_departing_late</th>
      <th>num_arriving_late</th>
      <th>prop_late_departures</th>
      <th>prop_late_arrivals</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2017</td>
      <td>9</td>
      <td>PARIS EST</td>
      <td>METZ</td>
      <td>85.133779</td>
      <td>299</td>
      <td>0.752007</td>
      <td>0.419844</td>
      <td>15</td>
      <td>17.0</td>
      <td>0.050167</td>
      <td>0.056856</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2017</td>
      <td>9</td>
      <td>REIMS</td>
      <td>PARIS EST</td>
      <td>47.064516</td>
      <td>218</td>
      <td>1.263518</td>
      <td>1.137558</td>
      <td>10</td>
      <td>23.0</td>
      <td>0.045872</td>
      <td>0.105505</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017</td>
      <td>9</td>
      <td>PARIS EST</td>
      <td>STRASBOURG</td>
      <td>116.234940</td>
      <td>333</td>
      <td>1.139257</td>
      <td>1.586396</td>
      <td>20</td>
      <td>19.0</td>
      <td>0.060060</td>
      <td>0.057057</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/logo_title.svg" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../notebooks.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="pyjanitor_intro.html">pyjanitor Usage Walkthrough</a></li>
<li class="toctree-l2"><a class="reference internal" href="Pivoting%20Data%20from%20Wide%20to%20Long.html">Pivot_Longer : One function to cover transformations from wide to long form.</a></li>
<li class="toctree-l2"><a class="reference internal" href="README.html">Examples</a></li>
<li class="toctree-l2"><a class="reference internal" href="Row_to_Names.html">row_to_names : Elevates a row to be the column names of a DataFrame.</a></li>
<li class="toctree-l2"><a class="reference internal" href="anime.html">Processing Anime Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="bad_values.html">Replacing Bad Values</a></li>
<li class="toctree-l2"><a class="reference internal" href="bird_call.html">Processing Bird Call Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="board_games.html">Processing Board Game Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="dirty_data.html">Processing Dirty Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="expand_grid.html">Expand_grid : Create a dataframe from all combinations of inputs.</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Processing French train data</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Background">Background</a></li>
<li class="toctree-l3"><a class="reference internal" href="#The-data">The data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Preliminaries">Preliminaries</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Call-chaining-example">Call chaining example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Step-by-step-through-the-methods">Step by step through the methods</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#Cleaning-column-names">Cleaning column names</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Renaming-columns">Renaming columns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Dropping-empty-columns-and-rows">Dropping empty columns and rows</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Drop-unneeded-columns">Drop unneeded columns</a></li>
<li class="toctree-l4"><a class="reference internal" href="#Add-additional-statistics-as-new-columns">Add additional statistics as new columns</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="groupby_agg.html">Groupby_agg : Shortcut for assigning a groupby-transform to a new column.</a></li>
<li class="toctree-l2"><a class="reference internal" href="inflating_converting_currency.html">Inflating and Converting Currency</a></li>
<li class="toctree-l2"><a class="reference internal" href="medium_franchise.html">Tidy Up Web-Scraped Media Franchise Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="normalize.html">Normalization and Standardization</a></li>
<li class="toctree-l2"><a class="reference internal" href="sort_naturally.html">Using <code class="docutils literal notranslate"><span class="pre">sort_naturally</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="teacher_pupil.html">Processing International Teacher Data</a></li>
<li class="toctree-l2"><a class="reference internal" href="transform_column.html">Transforming columns</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../reference/index.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../authors.html">Contributors</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="../notebooks.html">Examples</a><ul>
      <li>Previous: <a href="expand_grid.html" title="previous chapter">Expand_grid : Create a dataframe from all combinations of inputs.</a></li>
      <li>Next: <a href="groupby_agg.html" title="next chapter">Groupby_agg : Shortcut for assigning a groupby-transform to a new column.</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, PyJanitor devs.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.1.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/notebooks/french_trains.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>